Функция ПолучитьДействующийЛСПоВидуИЗданию(Здание, Период, ЕРЦ_ВидЛицевогоСчета) Экспорт 
	
	ЛицевойСчет = Справочники.КВП_ЛицевыеСчета.ПустаяСсылка();
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	РегистрСведенийКВП_ЛицевыеСчета.ЛицевойСчет КАК ЛицевойСчет
		|ИЗ
		|	РегистрСведений.КВП_ЛицевыеСчета КАК РегистрСведенийКВП_ЛицевыеСчета
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УПЖКХ_Помещения КАК УПЖКХ_Помещения
		|		ПО РегистрСведенийКВП_ЛицевыеСчета.Объект = УПЖКХ_Помещения.Ссылка
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КВП_ЛицевыеСчета КАК КВП_ЛицевыеСчета
		|		ПО РегистрСведенийКВП_ЛицевыеСчета.ЛицевойСчет = КВП_ЛицевыеСчета.Ссылка
		|ГДЕ
		|	РегистрСведенийКВП_ЛицевыеСчета.Период <= &Период
		|	И УПЖКХ_Помещения.Владелец = &Здание
		|	И КВП_ЛицевыеСчета.ЕРЦ_ВидЛицевогоСчета = &ЕРЦ_ВидЛицевогоСчета
		|
		|СГРУППИРОВАТЬ ПО
		|	РегистрСведенийКВП_ЛицевыеСчета.ЛицевойСчет
		|
		|ИМЕЮЩИЕ
		|	МАКСИМУМ(ВЫБОР
		|			КОГДА РегистрСведенийКВП_ЛицевыеСчета.Регистратор ССЫЛКА Документ.КВП_ЗакрытиеЛицевогоСчета
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		КОНЕЦ) = ЛОЖЬ";		
	Запрос.УстановитьПараметр("Здание", Здание);
	Запрос.УстановитьПараметр("Период", Период);
	Запрос.УстановитьПараметр("ЕРЦ_ВидЛицевогоСчета", ЕРЦ_ВидЛицевогоСчета);
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда 
		ЛицевойСчет = Выборка.ЛицевойСчет;
	КонецЕсли; 

	Возврат ЛицевойСчет;
		
КонецФункции // ПолучитьДействующийЛСПоВидуИЗданию()

#КонецОбласти  
